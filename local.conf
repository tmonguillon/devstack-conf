[[local|localrc]]

## Devstack with following services:
## - Keystone (identity)
## - Glance (image)
## - Nova (compute)
## - Neutron (network)
## - Heat (orchestrator)

##
## MISC
##
ADMIN_PASSWORD=password
MYSQL_PASSWORD=$ADMIN_PASSWORD
DATABASE_PASSWORD=$ADMIN_PASSWORD
RABBIT_PASSWORD=$ADMIN_PASSWORD
SERVICE_PASSWORD=$ADMIN_PASSWORD
SERVICE_TOKEN=token
HOST_IP=172.31.15.20

DEST=/opt/stack
DATA_DIR=$DEST/data
LOGFILE=$DEST/logs/stack.sh.log
LOGDAYS=1
LOG_COLOR=False
#ROOTSLEEP=0
SCREEN_LOGDIR=$DEST/logs/screen
VERBOSE=True
SCREEN_IS_LOGGING=True

# How services are started.
# From Pike devstack deploys services with systemd by default.
# Old fashion way can be reactivated
USE_SYSTEMD=False
USE_SCREEN=True

## Ubuntu: Disable cloud archive because of a bug in qemu/libvirt
ENABLE_UBUNTU_CLOUD_ARCHIVE=false

##
## Python parameters
##
#PIP_UPGRADE=true
#USE_CONSTRAINTS=false

##
## GIT behavior
GIT_BASE=http://github.com
RECLONE=False
OFFLINE=True

##
## Requirements
##
disable_all_services
enable_service mysql
enable_service rabbit
# New from Pike
enable_service etcd3

# Perf tracking
enable_service dstat
enable_service peakmem_tracker

##
## Requirements branch
##
REQUIREMENTS_BRANCH=stable/pike

##
## Keystone (Authentication service)
##
KEYSTONE_BRANCH=stable/pike

enable_service key

##
## Horizon (GUI)
##
HORIZON_BRANCH=stable/pike

enable_service horizon

##
## Nova (Compute Service)
##
NOVA_BRANCH=stable/pike
NOVNC_BRANCH=stable/v0.6

enable_service n-api
enable_service n-cond
enable_service n-sch
enable_service n-api-meta
enable_service n-cauth
enable_service n-novnc
enable_service n-cpu
enable_service n-sproxy
# New in Pike
enable_service placement-api
enable_service placement-client

# Custom parameters.
LIBVIRT_TYPE=kvm

##
## Neutron (Network Service)
##
NEUTRON_BRANCH=stable/pike

enable_service q-svc
enable_service q-agt
enable_service q-dhcp
enable_service q-l3
enable_service q-meta
enable_service q-metering
enable_service q-flavors

enable_plugin networking-sfc git://git.openstack.org/openstack/networking-sfc stable/pike

# Create default Network topology (IPv4)
NEUTRON_CREATE_INITIAL_NETWORKS=True
IP_VERSION=4
#PUBLIC_INTERFACE=ens32
# Declare a range for the ProviderNet
#FLOATING_RANGE=172.31.15.0/24
#Q_FLOATING_ALLOCATION_POOL=start=172.31.15.210,end=172.31.15.219
#PUBLIC_NETWORK_GATEWAY=172.31.15.1
# Declare a subnet safe to be used on devstack
IPV4_ADDRS_SAFE_TO_USE="10.254.0.0/16"

# Disable security groups
Q_USE_SECGROUP=False
LIBVIRT_FIREWALL_DRIVER=nova.virt.firewall.NoopFirewallDriver

# OVS configuration
Q_USE_PROVIDERNET_FOR_PUBLIC=True
OVS_PHYSICAL_BRIDGE=br-ex
PUBLIC_BRIDGE=br-ex
OVS_BRIDGE_MAPPINGS=public:br-ex


##
## Glance (Image Service)
##
GLANCE_BRANCH=stable/pike

enable_service g-api
enable_service g-reg

DOWNLOAD_DEFAULT_IMAGES=False
IMAGE_URLS="http://download.cirros-cloud.net/0.4.0/cirros-0.4.0-x86_64-disk.img"
IMAGE_URLS+=",http://cloud-images.ubuntu.com/xenial/current/xenial-server-cloudimg-amd64-disk1.img"
IMAGE_URLS+=",http://cdimage.debian.org/cdimage/openstack/current/debian-9.3.4-20180118-openstack-amd64.qcow2"
IMAGE_URLS+=",https://download.fedoraproject.org/pub/fedora/linux/releases/27/CloudImages/x86_64/images/Fedora-Cloud-Base-27-1.6.x86_64.qcow2"
IMAGE_URLS+=",https://cloud-images.ubuntu.com/releases/trusty/release/ubuntu-14.04-server-cloudimg-amd64-disk1.img"

##
## Cinder (Block device service)
##
CINDER_BRANCH=stable/pike

enable_service c-sch
enable_service c-api
enable_service c-bak
enable_service c-vol

##
## Heat (Orchestration Service)
##
## Since Newton, need to be specified as devstack plugin. No more provided by default.
enable_plugin heat https://git.openstack.org/openstack/heat stable/pike

##
## Swift
##
#SWIFT_BRANCH=stable/pike

##
## Post configuration
##

[[post-config|$NOVA_CONF]]
[DEFAULT]
vnc_keymap = fr
use_journal = True
[vnc]
keymap = fr
[libvirt]
cpu_mode = host-passthrough

[[post-config|$KEYSTONE_CONF]]
[DEFAULT]
use_journal = True

[[post-config|$NEUTRON_CONF]]
[DEFAULT]
use_journal = True

[[post-config|$GLANCE_CONF]]
[DEFAULT]
use_journal = True

[[post-config|$HORIZON_CONF]]
[DEFAULT]
use_journal = True

[[post-config|$HEAT_CONF]]
[DEFAULT]
use_journal = True

[[post-config|/etc/neutron/dhcp_agent.ini]]
[DEFAULT]
dnsmasq_config_file = /etc/neutron/dnsmasq.conf
